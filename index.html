<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Mizan: Soul Tracker</title>
    <style>
        :root {
            --primary: #2c5e55; /* Deep Sufi Green */
            --accent: #d4a373;  /* Desert Sand */
            --bg: #fdfcf5;      /* Parchment */
            --text: #333;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: var(--shadow);
        }

        h1 { margin: 0; font-size: 1.5rem; font-weight: 300; letter-spacing: 2px; }
        .subtitle { font-size: 0.9rem; opacity: 0.9; font-style: italic; margin-top: 5px; }

        main {
            flex: 1;
            padding: 1.5rem;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .gate-indicator {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1.5px;
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: block;
        }

        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #555; }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
            background: #fafafa;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 1rem;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #777;
            margin-top: -10px;
            margin-bottom: 1rem;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover { background-color: #1a3c36; }

        .recommendation-box {
            background-color: #eef5f3;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 4px;
            display: none;
        }

        .history-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .history-meta { font-size: 0.8rem; color: #888; }
        .history-wisdom { font-style: italic; color: var(--primary); font-size: 0.9rem; margin-top: 5px;}

        /* Tabs */
        .tabs { display: flex; justify-content: center; margin-bottom: 1rem; }
        .tab { 
            padding: 10px 20px; 
            cursor: pointer; 
            border-bottom: 2px solid transparent; 
            color: #888;
        }
        .tab.active { 
            border-bottom: 2px solid var(--primary); 
            color: var(--primary); 
            font-weight: bold;
        }

        .hidden { display: none; }

    </style>
</head>
<body>

<header>
    <h1>AL-MIZAN</h1>
    <div class="subtitle" id="current-gate">Loading Time...</div>
</header>

<main>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('checkin')">Check-In</div>
        <div class="tab" onclick="switchTab('muhasabah')">Muhasabah (History)</div>
    </div>

    <!-- Check-In Section -->
    <div id="checkin-view">
        <div class="card">
            <span class="gate-indicator">State of the Heart</span>
            
            <label>How is your spirit? (Mood)</label>
            <input type="range" id="mood" min="1" max="5" step="1" value="3">
            <div class="range-labels">
                <span>Heavy/Contraction</span>
                <span>Balanced</span>
                <span>Light/Expansion</span>
            </div>

            <label>Current Activity</label>
            <input type="text" id="activity" placeholder="e.g., Working, Eating, Resting...">

            <label>Dominant Thought</label>
            <textarea id="thoughts" rows="3" placeholder="What is occupying your mind?"></textarea>

            <button onclick="processEntry()">Submit Reflection</button>
        </div>

        <div id="recommendation" class="recommendation-box">
            <strong>Prescription for the Soul:</strong>
            <p id="rec-text"></p>
        </div>
    </div>

    <!-- History Section -->
    <div id="muhasabah-view" class="hidden">
        <div class="card">
            <span class="gate-indicator">Previous Reflections</span>
            <div id="history-log">
                <p style="text-align:center; color:#999;">No entries yet.</p>
            </div>
            <button onclick="clearHistory()" style="background:#d4a373; margin-top:10px;">Clear History</button>
        </div>
    </div>
</main>

<script>
    // === 1. The Time System (Based on 5 Prayer Times/Gates) ===
    function getCurrentGate() {
        const hour = new Date().getHours();
        if (hour >= 4 && hour < 12) return "Fajr (The Awakening)";
        if (hour >= 12 && hour < 15) return "Dhuhr (The Noon Height)";
        if (hour >= 15 && hour < 18) return "Asr (The Decline)";
        if (hour >= 18 && hour < 20) return "Maghrib (The Sunset)";
        return "Isha (The Night Stillness)";
    }

    document.getElementById('current-gate').innerText = getCurrentGate();

    // === 2. The Wisdom Engine (Sufi/Essene Recommendations) ===
    const wisdomDatabase = {
        low: [
            "Your spirit feels heavy (Qabd). Practice the 'Earth Breath': Inhale for 4, hold for 4, exhale for 4. Ground yourself.",
            "Wash your face with cold water (Wudu) to reset your state.",
            "Recite 'Ya Latif' (Oh Gentle One) and seek gentleness in this moment.",
            "Walk outside and touch a tree or the ground. Reconnect with the Essence of Earth."
        ],
        balanced: [
            "You are in equilibrium. Use this time for 'Muraqaba' (Observation). Watch your thoughts without judgment.",
            "Maintain this state with gratitude. Say 'Alhamdulillah' for the stability of your heart.",
            "A moment of silence. Listen to the sounds of nature around you.",
            "Proceed with your work, but dedicate the fruit of your action to something higher than yourself."
        ],
        high: [
            "Your spirit is expanded (Bast). Channel this energy into service (Khidmat) for another person.",
            "Be careful of arrogance in high spirits. Lower your gaze and humble your heart.",
            "Use this energy for a difficult task you have been avoiding.",
            "Share your joy. A smile is charity."
        ]
    };

    // === 3. Logic & Storage ===
    
    function switchTab(tabName) {
        document.getElementById('checkin-view').classList.add('hidden');
        document.getElementById('muhasabah-view').classList.add('hidden');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

        document.getElementById(tabName + '-view').classList.remove('hidden');
        event.target.classList.add('active');
        
        if(tabName === 'muhasabah') renderHistory();
    }

    function processEntry() {
        const moodVal = parseInt(document.getElementById('mood').value);
        const activity = document.getElementById('activity').value;
        const thoughts = document.getElementById('thoughts').value;
        const gate = getCurrentGate();
        const timestamp = new Date().toLocaleString();

        // 1. Generate Recommendation
        let recText = "";
        let moodType = "";
        if (moodVal <= 2) {
            moodType = "low";
            recText = wisdomDatabase.low[Math.floor(Math.random() * wisdomDatabase.low.length)];
        } else if (moodVal === 3) {
            moodType = "balanced";
            recText = wisdomDatabase.balanced[Math.floor(Math.random() * wisdomDatabase.balanced.length)];
        } else {
            moodType = "high";
            recText = wisdomDatabase.high[Math.floor(Math.random() * wisdomDatabase.high.length)];
        }

        // 2. Show Recommendation
        const recBox = document.getElementById('recommendation');
        document.getElementById('rec-text').innerText = recText;
        recBox.style.display = "block";
        recBox.scrollIntoView({ behavior: 'smooth' });

        // 3. Save to LocalStorage
        const entry = {
            id: Date.now(),
            date: timestamp,
            gate: gate,
            mood: moodVal,
            activity: activity,
            thoughts: thoughts,
            prescription: recText
        };

        let history = JSON.parse(localStorage.getItem('sufiTrackerData')) || [];
        history.unshift(entry); // Add to top
        localStorage.setItem('sufiTrackerData', JSON.stringify(history));

        // 4. Reset form fields (optional, keeping values for now so user can see what they typed)
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('sufiTrackerData')) || [];
        const container = document.getElementById('history-log');
        
        if (history.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999;">No entries yet.</p>';
            return;
        }

        container.innerHTML = history.map(item => `
            <div class="history-item">
                <div class="history-meta">
                    <strong>${item.gate}</strong> <br> ${item.date}
                </div>
                <div style="margin: 5px 0;">
                    Mood: ${getMoodLabel(item.mood)} | Doing: ${item.activity}
                </div>
                <div style="font-style: italic; color: #555;">"${item.thoughts}"</div>
                <div class="history-wisdom">Tip: ${item.prescription}</div>
            </div>
        `).join('');
    }

    function getMoodLabel(val) {
        if(val <= 2) return "Contraction (Qabd)";
        if(val == 3) return "Balance (Mizan)";
        return "Expansion (Bast)";
    }

    function clearHistory() {
        if(confirm("Are you sure you want to clear your reflections?")) {
            localStorage.removeItem('sufiTrackerData');
            renderHistory();
        }
    }
</script>

</body>
</html>